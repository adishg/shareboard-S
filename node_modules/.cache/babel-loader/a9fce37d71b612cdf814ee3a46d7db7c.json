{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/var/www/html/excalidraw/src/components/TopErrorBoundary.tsx\";\nimport React from \"react\";\nimport * as Sentry from \"@sentry/browser\";\nimport { resetCursor } from \"../utils\";\nimport { t } from \"../i18n\";\nexport class TopErrorBoundary extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      hasError: false,\n      sentryEventId: \"\",\n      localStorage: \"\"\n    };\n  }\n\n  render() {\n    return this.state.hasError ? this.errorSplash() : this.props.children;\n  }\n\n  componentDidCatch(error, errorInfo) {\n    resetCursor();\n    const _localStorage = {};\n\n    for (const [key, value] of Object.entries({ ...localStorage\n    })) {\n      try {\n        _localStorage[key] = JSON.parse(value);\n      } catch (error) {\n        _localStorage[key] = value;\n      }\n    }\n\n    Sentry.withScope(scope => {\n      scope.setExtras(errorInfo);\n      const eventId = Sentry.captureException(error);\n      this.setState(state => ({\n        hasError: true,\n        sentryEventId: eventId,\n        localStorage: JSON.stringify(_localStorage)\n      }));\n    });\n  }\n\n  selectTextArea(event) {\n    if (event.target !== document.activeElement) {\n      event.preventDefault();\n      event.target.select();\n    }\n  }\n\n  async createGithubIssue() {\n    let body = \"\";\n\n    try {\n      const templateStrFn = (await import(\n      /* webpackChunkName: \"bug-issue-template\" */\n      \"../bug-issue-template\")).default;\n      body = encodeURIComponent(templateStrFn(this.state.sentryEventId));\n    } catch (error) {\n      console.error(error);\n    }\n\n    window.open(`https://github.com/excalidraw/excalidraw/issues/new?body=${body}`);\n  }\n\n  errorSplash() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ErrorSplash excalidraw\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ErrorSplash-messageContainer\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ErrorSplash-paragraph bigger align-center\",\n          children: [t(\"errorSplash.headingMain_pre\"), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => window.location.reload(),\n            children: t(\"errorSplash.headingMain_button\")\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ErrorSplash-paragraph align-center\",\n          children: [t(\"errorSplash.clearCanvasMessage\"), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              try {\n                localStorage.clear();\n                window.location.reload();\n              } catch (error) {\n                console.error(error);\n              }\n            },\n            children: t(\"errorSplash.clearCanvasMessage_button\")\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"smaller\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              role: \"img\",\n              \"aria-label\": \"warning\",\n              children: \"\\u26A0\\uFE0F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 15\n            }, this), t(\"errorSplash.clearCanvasCaveat\"), /*#__PURE__*/_jsxDEV(\"span\", {\n              role: \"img\",\n              \"aria-hidden\": \"true\",\n              children: \"\\u26A0\\uFE0F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ErrorSplash-paragraph\",\n            children: [t(\"errorSplash.trackedToSentry_pre\"), this.state.sentryEventId, t(\"errorSplash.trackedToSentry_post\")]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ErrorSplash-paragraph\",\n            children: [t(\"errorSplash.openIssueMessage_pre\"), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => this.createGithubIssue(),\n              children: t(\"errorSplash.openIssueMessage_button\")\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 117,\n              columnNumber: 15\n            }, this), t(\"errorSplash.openIssueMessage_post\")]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ErrorSplash-paragraph\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ErrorSplash-details\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                children: t(\"errorSplash.sceneContent\")\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 124,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n                rows: 5,\n                onPointerDown: this.selectTextArea,\n                readOnly: true,\n                value: this.state.localStorage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/var/www/html/excalidraw/src/components/TopErrorBoundary.tsx"],"names":["React","Sentry","resetCursor","t","TopErrorBoundary","Component","state","hasError","sentryEventId","localStorage","render","errorSplash","props","children","componentDidCatch","error","errorInfo","_localStorage","key","value","Object","entries","JSON","parse","withScope","scope","setExtras","eventId","captureException","setState","stringify","selectTextArea","event","target","document","activeElement","preventDefault","select","createGithubIssue","body","templateStrFn","default","encodeURIComponent","console","window","open","location","reload","clear"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport * as Sentry from \"@sentry/browser\";\nimport { resetCursor } from \"../utils\";\nimport { t } from \"../i18n\";\n\ninterface TopErrorBoundaryState {\n  hasError: boolean;\n  sentryEventId: string;\n  localStorage: string;\n}\n\nexport class TopErrorBoundary extends React.Component<\n  any,\n  TopErrorBoundaryState\n> {\n  state: TopErrorBoundaryState = {\n    hasError: false,\n    sentryEventId: \"\",\n    localStorage: \"\",\n  };\n\n  render() {\n    return this.state.hasError ? this.errorSplash() : this.props.children;\n  }\n\n  componentDidCatch(error: Error, errorInfo: any) {\n    resetCursor();\n    const _localStorage: any = {};\n    for (const [key, value] of Object.entries({ ...localStorage })) {\n      try {\n        _localStorage[key] = JSON.parse(value);\n      } catch (error) {\n        _localStorage[key] = value;\n      }\n    }\n\n    Sentry.withScope((scope) => {\n      scope.setExtras(errorInfo);\n      const eventId = Sentry.captureException(error);\n\n      this.setState((state) => ({\n        hasError: true,\n        sentryEventId: eventId,\n        localStorage: JSON.stringify(_localStorage),\n      }));\n    });\n  }\n\n  private selectTextArea(event: React.MouseEvent<HTMLTextAreaElement>) {\n    if (event.target !== document.activeElement) {\n      event.preventDefault();\n      (event.target as HTMLTextAreaElement).select();\n    }\n  }\n\n  private async createGithubIssue() {\n    let body = \"\";\n    try {\n      const templateStrFn = (\n        await import(\n          /* webpackChunkName: \"bug-issue-template\" */ \"../bug-issue-template\"\n        )\n      ).default;\n      body = encodeURIComponent(templateStrFn(this.state.sentryEventId));\n    } catch (error) {\n      console.error(error);\n    }\n\n    window.open(\n      `https://github.com/excalidraw/excalidraw/issues/new?body=${body}`,\n    );\n  }\n\n  private errorSplash() {\n    return (\n      <div className=\"ErrorSplash excalidraw\">\n        <div className=\"ErrorSplash-messageContainer\">\n          <div className=\"ErrorSplash-paragraph bigger align-center\">\n            {t(\"errorSplash.headingMain_pre\")}\n            <button onClick={() => window.location.reload()}>\n              {t(\"errorSplash.headingMain_button\")}\n            </button>\n          </div>\n          <div className=\"ErrorSplash-paragraph align-center\">\n            {t(\"errorSplash.clearCanvasMessage\")}\n            <button\n              onClick={() => {\n                try {\n                  localStorage.clear();\n                  window.location.reload();\n                } catch (error) {\n                  console.error(error);\n                }\n              }}\n            >\n              {t(\"errorSplash.clearCanvasMessage_button\")}\n            </button>\n            <br />\n            <div className=\"smaller\">\n              <span role=\"img\" aria-label=\"warning\">\n                ⚠️\n              </span>\n              {t(\"errorSplash.clearCanvasCaveat\")}\n              <span role=\"img\" aria-hidden=\"true\">\n                ⚠️\n              </span>\n            </div>\n          </div>\n          <div>\n            <div className=\"ErrorSplash-paragraph\">\n              {t(\"errorSplash.trackedToSentry_pre\")}\n              {this.state.sentryEventId}\n              {t(\"errorSplash.trackedToSentry_post\")}\n            </div>\n            <div className=\"ErrorSplash-paragraph\">\n              {t(\"errorSplash.openIssueMessage_pre\")}\n              <button onClick={() => this.createGithubIssue()}>\n                {t(\"errorSplash.openIssueMessage_button\")}\n              </button>\n              {t(\"errorSplash.openIssueMessage_post\")}\n            </div>\n            <div className=\"ErrorSplash-paragraph\">\n              <div className=\"ErrorSplash-details\">\n                <label>{t(\"errorSplash.sceneContent\")}</label>\n                <textarea\n                  rows={5}\n                  onPointerDown={this.selectTextArea}\n                  readOnly={true}\n                  value={this.state.localStorage}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}