{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/var/www/html/excalidraw/src/components/LayerUI.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$(),\n    _s4 = $RefreshSig$();\n\nimport clsx from \"clsx\";\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { CLASSES } from \"../constants\";\nimport { exportCanvas } from \"../data\";\nimport { importLibraryFromJSON, saveLibraryAsJSON } from \"../data/json\";\nimport { Library } from \"../data/library\";\nimport { showSelectedShapeActions } from \"../element\";\nimport { t } from \"../i18n\";\nimport useIsMobile from \"../is-mobile\";\nimport { calculateScrollCenter, getSelectedElements } from \"../scene\";\nimport { muteFSAbortError } from \"../utils\";\nimport { SelectedShapeActions, ShapesSwitcher, ZoomActions } from \"./Actions\";\nimport { BackgroundPickerAndDarkModeToggle } from \"./BackgroundPickerAndDarkModeToggle\";\nimport CollabButton from \"./CollabButton\";\nimport { ErrorDialog } from \"./ErrorDialog\";\nimport { ExportDialog } from \"./ExportDialog\";\nimport { FixedSideContainer } from \"./FixedSideContainer\";\nimport { GitHubCorner } from \"./GitHubCorner\";\nimport { HintViewer } from \"./HintViewer\";\nimport { exportFile, load, shield } from \"./icons\";\nimport { Island } from \"./Island\";\nimport \"./LayerUI.scss\";\nimport { LibraryUnit } from \"./LibraryUnit\";\nimport { LoadingMessage } from \"./LoadingMessage\";\nimport { LockIcon } from \"./LockIcon\";\nimport { MobileMenu } from \"./MobileMenu\";\nimport { PasteChartDialog } from \"./PasteChartDialog\";\nimport { Section } from \"./Section\";\nimport { ShortcutsDialog } from \"./ShortcutsDialog\";\nimport Stack from \"./Stack\";\nimport { ToolButton } from \"./ToolButton\";\nimport { Tooltip } from \"./Tooltip\";\nimport { UserList } from \"./UserList\";\n\nconst useOnClickOutside = (ref, cb) => {\n  _s();\n\n  useEffect(() => {\n    const listener = event => {\n      if (!ref.current) {\n        return;\n      }\n\n      if (event.target instanceof Element && (ref.current.contains(event.target) || !document.body.contains(event.target))) {\n        return;\n      }\n\n      cb(event);\n    };\n\n    document.addEventListener(\"pointerdown\", listener, false);\n    return () => {\n      document.removeEventListener(\"pointerdown\", listener);\n    };\n  }, [ref, cb]);\n};\n\n_s(useOnClickOutside, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\nconst LibraryMenuItems = ({\n  library,\n  onRemoveFromLibrary,\n  onAddToLibrary,\n  onInsertShape,\n  pendingElements,\n  setAppState\n}) => {\n  _s2();\n\n  const isMobile = useIsMobile();\n  const numCells = library.length + (pendingElements.length > 0 ? 1 : 0);\n  const CELLS_PER_ROW = isMobile ? 4 : 6;\n  const numRows = Math.max(1, Math.ceil(numCells / CELLS_PER_ROW));\n  const rows = [];\n  let addedPendingElements = false;\n  rows.push( /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"layer-ui__library-header\",\n    children: [/*#__PURE__*/_jsxDEV(ToolButton, {\n      type: \"button\",\n      title: t(\"buttons.load\"),\n      \"aria-label\": t(\"buttons.load\"),\n      icon: load,\n      onClick: () => {\n        importLibraryFromJSON().then(() => {\n          // Maybe we should close and open the menu so that the items get updated.\n          // But for now we just close the menu.\n          setAppState({\n            isLibraryOpen: false\n          });\n        }).catch(muteFSAbortError).catch(error => {\n          setAppState({\n            errorMessage: error.message\n          });\n        });\n      }\n    }, \"import\", false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ToolButton, {\n      type: \"button\",\n      title: t(\"buttons.export\"),\n      \"aria-label\": t(\"buttons.export\"),\n      icon: exportFile,\n      onClick: () => {\n        saveLibraryAsJSON().catch(muteFSAbortError).catch(error => {\n          setAppState({\n            errorMessage: error.message\n          });\n        });\n      }\n    }, \"export\", false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n      href: \"https://libraries.excalidraw.com\",\n      target: \"_excalidraw_libraries\",\n      children: t(\"labels.libraries\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this));\n\n  for (let row = 0; row < numRows; row++) {\n    const y = CELLS_PER_ROW * row;\n    const children = [];\n\n    for (let x = 0; x < CELLS_PER_ROW; x++) {\n      const shouldAddPendingElements = pendingElements.length > 0 && !addedPendingElements && y + x >= library.length;\n      addedPendingElements = addedPendingElements || shouldAddPendingElements;\n      children.push( /*#__PURE__*/_jsxDEV(Stack.Col, {\n        children: /*#__PURE__*/_jsxDEV(LibraryUnit, {\n          elements: library[y + x],\n          pendingElements: shouldAddPendingElements ? pendingElements : undefined,\n          onRemoveFromLibrary: onRemoveFromLibrary.bind(null, y + x),\n          onClick: shouldAddPendingElements ? onAddToLibrary.bind(null, pendingElements) : onInsertShape.bind(null, library[y + x])\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 11\n        }, this)\n      }, x, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this));\n    }\n\n    rows.push( /*#__PURE__*/_jsxDEV(Stack.Row, {\n      align: \"center\",\n      gap: 1,\n      children: children\n    }, row, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }, this));\n  }\n\n  return /*#__PURE__*/_jsxDEV(Stack.Col, {\n    align: \"start\",\n    gap: 1,\n    className: \"layer-ui__library-items\",\n    children: rows\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 193,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(LibraryMenuItems, \"zdJ8C3X+YlDYVai5EPOd8CzoqSU=\", false, function () {\n  return [useIsMobile];\n});\n\n_c = LibraryMenuItems;\n\nconst LibraryMenu = ({\n  onClickOutside,\n  onInsertShape,\n  pendingElements,\n  onAddToLibrary,\n  setAppState\n}) => {\n  _s3();\n\n  const ref = useRef(null);\n  useOnClickOutside(ref, event => {\n    // If click on the library icon, do nothing.\n    if (event.target.closest(\".ToolIcon_type_button__library\")) {\n      return;\n    }\n\n    onClickOutside(event);\n  });\n  const [libraryItems, setLibraryItems] = useState([]);\n  const [loadingState, setIsLoading] = useState(\"preloading\");\n  const loadingTimerRef = useRef(null);\n  useEffect(() => {\n    Promise.race([new Promise(resolve => {\n      loadingTimerRef.current = setTimeout(() => {\n        resolve(\"loading\");\n      }, 100);\n    }), Library.loadLibrary().then(items => {\n      setLibraryItems(items);\n      setIsLoading(\"ready\");\n    })]).then(data => {\n      if (data === \"loading\") {\n        setIsLoading(\"loading\");\n      }\n    });\n    return () => {\n      clearTimeout(loadingTimerRef.current);\n    };\n  }, []);\n  const removeFromLibrary = useCallback(async indexToRemove => {\n    const items = await Library.loadLibrary();\n    const nextItems = items.filter((_, index) => index !== indexToRemove);\n    Library.saveLibrary(nextItems);\n    setLibraryItems(nextItems);\n  }, []);\n  const addToLibrary = useCallback(async elements => {\n    const items = await Library.loadLibrary();\n    const nextItems = [...items, elements];\n    onAddToLibrary();\n    Library.saveLibrary(nextItems);\n    setLibraryItems(nextItems);\n  }, [onAddToLibrary]);\n  return loadingState === \"preloading\" ? null : /*#__PURE__*/_jsxDEV(Island, {\n    padding: 1,\n    ref: ref,\n    className: \"layer-ui__library\",\n    children: loadingState === \"loading\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"layer-ui__library-message\",\n      children: t(\"labels.libraryLoadingMessage\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(LibraryMenuItems, {\n      library: libraryItems,\n      onRemoveFromLibrary: removeFromLibrary,\n      onAddToLibrary: addToLibrary,\n      onInsertShape: onInsertShape,\n      pendingElements: pendingElements,\n      setAppState: setAppState\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 269,\n    columnNumber: 5\n  }, this);\n};\n\n_s3(LibraryMenu, \"Q8ak1coUjUtkGxYpvyPRc2ZCaFM=\", false, function () {\n  return [useOnClickOutside];\n});\n\n_c2 = LibraryMenu;\n\nconst LayerUI = ({\n  actionManager,\n  appState,\n  setAppState,\n  canvas,\n  elements,\n  onCollabButtonClick,\n  onLockToggle,\n  onInsertElements,\n  zenModeEnabled,\n  toggleZenMode,\n  isCollaborating,\n  onExportToBackend,\n  renderCustomFooter\n}) => {\n  _s4();\n\n  const isMobile = useIsMobile();\n\n  const renderEncryptedIcon = () => /*#__PURE__*/_jsxDEV(\"a\", {\n    className: clsx(\"encrypted-icon tooltip zen-mode-visibility\", {\n      \"zen-mode-visibility--hidden\": zenModeEnabled\n    }),\n    href: \"https://blog.excalidraw.com/end-to-end-encryption/\",\n    target: \"_blank\",\n    rel: \"noopener noreferrer\",\n    children: /*#__PURE__*/_jsxDEV(Tooltip, {\n      label: t(\"encrypted.tooltip\"),\n      position: \"above\",\n      long: true,\n      children: shield\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 306,\n    columnNumber: 5\n  }, this);\n\n  const renderExportDialog = () => {\n    const createExporter = type => async (exportedElements, scale) => {\n      if (canvas) {\n        await exportCanvas(type, exportedElements, appState, canvas, {\n          exportBackground: appState.exportBackground,\n          name: appState.name,\n          viewBackgroundColor: appState.viewBackgroundColor,\n          scale,\n          shouldAddWatermark: appState.shouldAddWatermark\n        }).catch(muteFSAbortError).catch(error => {\n          console.error(error);\n          setAppState({\n            errorMessage: error.message\n          });\n        });\n      }\n    };\n\n    return /*#__PURE__*/_jsxDEV(ExportDialog, {\n      elements: elements,\n      appState: appState,\n      actionManager: actionManager,\n      onExportToPng: createExporter(\"png\"),\n      onExportToSvg: createExporter(\"svg\"),\n      onExportToClipboard: createExporter(\"clipboard\"),\n      onExportToBackend: onExportToBackend ? elements => {\n        onExportToBackend && onExportToBackend(elements, appState, canvas);\n      } : undefined\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderCanvasActions = () => /*#__PURE__*/_jsxDEV(Section, {\n    heading: \"canvasActions\",\n    className: clsx(\"zen-mode-transition\", {\n      \"transition-left\": zenModeEnabled\n    }),\n    children: /*#__PURE__*/_jsxDEV(Island, {\n      padding: 2,\n      style: {\n        zIndex: 1\n      },\n      children: /*#__PURE__*/_jsxDEV(Stack.Col, {\n        gap: 4,\n        children: [/*#__PURE__*/_jsxDEV(Stack.Row, {\n          gap: 1,\n          justifyContent: \"space-between\",\n          children: [actionManager.renderAction(\"loadScene\"), actionManager.renderAction(\"saveScene\"), actionManager.renderAction(\"saveAsScene\"), renderExportDialog(), actionManager.renderAction(\"clearCanvas\"), onCollabButtonClick && /*#__PURE__*/_jsxDEV(CollabButton, {\n            isCollaborating: isCollaborating,\n            collaboratorCount: appState.collaborators.size,\n            onClick: onCollabButtonClick\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 379,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(BackgroundPickerAndDarkModeToggle, {\n          actionManager: actionManager,\n          appState: appState,\n          setAppState: setAppState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 362,\n    columnNumber: 5\n  }, this);\n\n  const renderSelectedShapeActions = () => /*#__PURE__*/_jsxDEV(Section, {\n    heading: \"selectedShapeActions\",\n    className: clsx(\"zen-mode-transition\", {\n      \"transition-left\": zenModeEnabled\n    }),\n    children: /*#__PURE__*/_jsxDEV(Island, {\n      className: CLASSES.SHAPE_ACTIONS_MENU,\n      padding: 2,\n      children: /*#__PURE__*/_jsxDEV(SelectedShapeActions, {\n        appState: appState,\n        elements: elements,\n        renderAction: actionManager.renderAction,\n        elementType: appState.elementType\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 397,\n    columnNumber: 5\n  }, this);\n\n  const closeLibrary = useCallback(event => {\n    setAppState({\n      isLibraryOpen: false\n    });\n  }, [setAppState]);\n  const deselectItems = useCallback(() => {\n    setAppState({\n      selectedElementIds: {},\n      selectedGroupIds: {}\n    });\n  }, [setAppState]);\n  const libraryMenu = appState.isLibraryOpen ? /*#__PURE__*/_jsxDEV(LibraryMenu, {\n    pendingElements: getSelectedElements(elements, appState),\n    onClickOutside: closeLibrary,\n    onInsertShape: onInsertElements,\n    onAddToLibrary: deselectItems,\n    setAppState: setAppState\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 429,\n    columnNumber: 5\n  }, this) : null;\n\n  const renderFixedSideContainer = () => {\n    const shouldRenderSelectedShapeActions = showSelectedShapeActions(appState, elements);\n    return /*#__PURE__*/_jsxDEV(FixedSideContainer, {\n      side: \"top\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App-menu App-menu_top\",\n        children: [/*#__PURE__*/_jsxDEV(Stack.Col, {\n          gap: 4,\n          className: clsx({\n            \"disable-pointerEvents\": zenModeEnabled\n          }),\n          children: [renderCanvasActions(), shouldRenderSelectedShapeActions && renderSelectedShapeActions()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Section, {\n          heading: \"shapes\",\n          children: heading => /*#__PURE__*/_jsxDEV(Stack.Col, {\n            gap: 4,\n            align: \"start\",\n            children: [/*#__PURE__*/_jsxDEV(Stack.Row, {\n              gap: 1,\n              children: [/*#__PURE__*/_jsxDEV(Island, {\n                padding: 1,\n                className: clsx({\n                  \"zen-mode\": zenModeEnabled\n                }),\n                children: [/*#__PURE__*/_jsxDEV(HintViewer, {\n                  appState: appState,\n                  elements: elements\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 462,\n                  columnNumber: 21\n                }, this), heading, /*#__PURE__*/_jsxDEV(Stack.Row, {\n                  gap: 1,\n                  children: /*#__PURE__*/_jsxDEV(ShapesSwitcher, {\n                    elementType: appState.elementType,\n                    setAppState: setAppState,\n                    isLibraryOpen: appState.isLibraryOpen\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 465,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 464,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 458,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(LockIcon, {\n                zenModeEnabled: zenModeEnabled,\n                checked: appState.elementLocked,\n                onChange: onLockToggle,\n                title: t(\"toolBar.lock\")\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 472,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 457,\n              columnNumber: 17\n            }, this), libraryMenu]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 456,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(UserList, {\n          className: clsx(\"zen-mode-transition\", {\n            \"transition-right\": zenModeEnabled\n          }),\n          children: Array.from(appState.collaborators) // Collaborator is either not initialized or is actually the current user.\n          .filter(([_, client]) => Object.keys(client).length !== 0).map(([clientId, client]) => /*#__PURE__*/_jsxDEV(Tooltip, {\n            label: client.username || \"Unknown user\",\n            children: actionManager.renderAction(\"goToCollaborator\", clientId)\n          }, clientId, false, {\n            fileName: _jsxFileName,\n            lineNumber: 492,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderBottomAppMenu = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: clsx(\"App-menu App-menu_bottom zen-mode-transition\", {\n        \"App-menu_bottom--transition-left\": zenModeEnabled\n      }),\n      children: /*#__PURE__*/_jsxDEV(Stack.Col, {\n        gap: 2,\n        children: /*#__PURE__*/_jsxDEV(Section, {\n          heading: \"canvasActions\",\n          children: [/*#__PURE__*/_jsxDEV(Island, {\n            padding: 1,\n            children: /*#__PURE__*/_jsxDEV(ZoomActions, {\n              renderAction: actionManager.renderAction,\n              zoom: appState.zoom\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 515,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 514,\n            columnNumber: 13\n          }, this), renderEncryptedIcon()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 513,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 507,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderFooter = () => /*#__PURE__*/_jsxDEV(\"footer\", {\n    role: \"contentinfo\",\n    className: \"layer-ui__wrapper__footer\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: clsx(\"zen-mode-transition\", {\n        \"transition-right disable-pointerEvents\": zenModeEnabled\n      }),\n      children: [renderCustomFooter === null || renderCustomFooter === void 0 ? void 0 : renderCustomFooter(false), actionManager.renderAction(\"toggleShortcuts\")]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 529,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: clsx(\"disable-zen-mode\", {\n        \"disable-zen-mode--visible\": zenModeEnabled\n      }),\n      onClick: toggleZenMode,\n      children: t(\"buttons.exitZenMode\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 537,\n      columnNumber: 7\n    }, this), appState.scrolledOutside && /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"scroll-back-to-content\",\n      onClick: () => {\n        setAppState({ ...calculateScrollCenter(elements, appState, canvas)\n        });\n      },\n      children: t(\"buttons.scrollBackToContent\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 546,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 528,\n    columnNumber: 5\n  }, this);\n\n  const dialogs = /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [appState.isLoading && /*#__PURE__*/_jsxDEV(LoadingMessage, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 562,\n      columnNumber: 30\n    }, this), appState.errorMessage && /*#__PURE__*/_jsxDEV(ErrorDialog, {\n      message: appState.errorMessage,\n      onClose: () => setAppState({\n        errorMessage: null\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 564,\n      columnNumber: 9\n    }, this), appState.showShortcutsDialog && /*#__PURE__*/_jsxDEV(ShortcutsDialog, {\n      onClose: () => setAppState({\n        showShortcutsDialog: false\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 570,\n      columnNumber: 9\n    }, this), appState.pasteDialog.shown && /*#__PURE__*/_jsxDEV(PasteChartDialog, {\n      setAppState: setAppState,\n      appState: appState,\n      onInsertChart: onInsertElements,\n      onClose: () => setAppState({\n        pasteDialog: {\n          shown: false,\n          data: null\n        }\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 575,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n\n  return isMobile ? /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [dialogs, /*#__PURE__*/_jsxDEV(MobileMenu, {\n      appState: appState,\n      elements: elements,\n      actionManager: actionManager,\n      libraryMenu: libraryMenu,\n      exportButton: renderExportDialog(),\n      setAppState: setAppState,\n      onCollabButtonClick: onCollabButtonClick,\n      onLockToggle: onLockToggle,\n      canvas: canvas,\n      isCollaborating: isCollaborating,\n      renderCustomFooter: renderCustomFooter\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 592,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"layer-ui__wrapper\",\n    children: [dialogs, renderFixedSideContainer(), renderBottomAppMenu(), /*#__PURE__*/_jsxDEV(\"aside\", {\n      className: clsx(\"layer-ui__wrapper__github-corner zen-mode-transition\", {\n        \"transition-right\": zenModeEnabled\n      }),\n      children: /*#__PURE__*/_jsxDEV(GitHubCorner, {\n        appearance: appState.appearance\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 620,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 612,\n      columnNumber: 9\n    }, this), renderFooter()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 607,\n    columnNumber: 5\n  }, this);\n};\n\n_s4(LayerUI, \"C7Q0GtMcuqYVKkL1YfHeUs2iblE=\", false, function () {\n  return [useIsMobile];\n});\n\n_c3 = LayerUI;\n\nconst areEqual = (prev, next) => {\n  const getNecessaryObj = appState => {\n    const {\n      suggestedBindings,\n      startBoundElement: boundElement,\n      ...ret\n    } = appState;\n    return ret;\n  };\n\n  const prevAppState = getNecessaryObj(prev.appState);\n  const nextAppState = getNecessaryObj(next.appState);\n  const keys = Object.keys(prevAppState);\n  return prev.langCode === next.langCode && prev.elements === next.elements && keys.every(key => prevAppState[key] === nextAppState[key]);\n};\n\nexport default _c4 = /*#__PURE__*/React.memo(LayerUI, areEqual);\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"LibraryMenuItems\");\n$RefreshReg$(_c2, \"LibraryMenu\");\n$RefreshReg$(_c3, \"LayerUI\");\n$RefreshReg$(_c4, \"%default%\");","map":{"version":3,"sources":["/var/www/html/excalidraw/src/components/LayerUI.tsx"],"names":["clsx","React","useCallback","useEffect","useRef","useState","CLASSES","exportCanvas","importLibraryFromJSON","saveLibraryAsJSON","Library","showSelectedShapeActions","t","useIsMobile","calculateScrollCenter","getSelectedElements","muteFSAbortError","SelectedShapeActions","ShapesSwitcher","ZoomActions","BackgroundPickerAndDarkModeToggle","CollabButton","ErrorDialog","ExportDialog","FixedSideContainer","GitHubCorner","HintViewer","exportFile","load","shield","Island","LibraryUnit","LoadingMessage","LockIcon","MobileMenu","PasteChartDialog","Section","ShortcutsDialog","Stack","ToolButton","Tooltip","UserList","useOnClickOutside","ref","cb","listener","event","current","target","Element","contains","document","body","addEventListener","removeEventListener","LibraryMenuItems","library","onRemoveFromLibrary","onAddToLibrary","onInsertShape","pendingElements","setAppState","isMobile","numCells","length","CELLS_PER_ROW","numRows","Math","max","ceil","rows","addedPendingElements","push","then","isLibraryOpen","catch","error","errorMessage","message","row","y","children","x","shouldAddPendingElements","undefined","bind","LibraryMenu","onClickOutside","closest","libraryItems","setLibraryItems","loadingState","setIsLoading","loadingTimerRef","Promise","race","resolve","setTimeout","loadLibrary","items","data","clearTimeout","removeFromLibrary","indexToRemove","nextItems","filter","_","index","saveLibrary","addToLibrary","elements","LayerUI","actionManager","appState","canvas","onCollabButtonClick","onLockToggle","onInsertElements","zenModeEnabled","toggleZenMode","isCollaborating","onExportToBackend","renderCustomFooter","renderEncryptedIcon","renderExportDialog","createExporter","type","exportedElements","scale","exportBackground","name","viewBackgroundColor","shouldAddWatermark","console","renderCanvasActions","zIndex","renderAction","collaborators","size","renderSelectedShapeActions","SHAPE_ACTIONS_MENU","elementType","closeLibrary","deselectItems","selectedElementIds","selectedGroupIds","libraryMenu","renderFixedSideContainer","shouldRenderSelectedShapeActions","heading","elementLocked","Array","from","client","Object","keys","map","clientId","username","renderBottomAppMenu","zoom","renderFooter","scrolledOutside","dialogs","isLoading","showShortcutsDialog","pasteDialog","shown","appearance","areEqual","prev","next","getNecessaryObj","suggestedBindings","startBoundElement","boundElement","ret","prevAppState","nextAppState","langCode","every","key","memo"],"mappings":"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","sourcesContent":["import clsx from \"clsx\";\nimport React, {\n  RefObject,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { ActionManager } from \"../actions/manager\";\nimport { CLASSES } from \"../constants\";\nimport { exportCanvas } from \"../data\";\nimport { importLibraryFromJSON, saveLibraryAsJSON } from \"../data/json\";\nimport { Library } from \"../data/library\";\nimport { showSelectedShapeActions } from \"../element\";\nimport { NonDeletedExcalidrawElement } from \"../element/types\";\nimport { Language, t } from \"../i18n\";\nimport useIsMobile from \"../is-mobile\";\nimport { calculateScrollCenter, getSelectedElements } from \"../scene\";\nimport { ExportType } from \"../scene/types\";\nimport { AppState, LibraryItem, LibraryItems } from \"../types\";\nimport { muteFSAbortError } from \"../utils\";\nimport { SelectedShapeActions, ShapesSwitcher, ZoomActions } from \"./Actions\";\nimport { BackgroundPickerAndDarkModeToggle } from \"./BackgroundPickerAndDarkModeToggle\";\nimport CollabButton from \"./CollabButton\";\nimport { ErrorDialog } from \"./ErrorDialog\";\nimport { ExportCB, ExportDialog } from \"./ExportDialog\";\nimport { FixedSideContainer } from \"./FixedSideContainer\";\nimport { GitHubCorner } from \"./GitHubCorner\";\nimport { HintViewer } from \"./HintViewer\";\nimport { exportFile, load, shield } from \"./icons\";\nimport { Island } from \"./Island\";\nimport \"./LayerUI.scss\";\nimport { LibraryUnit } from \"./LibraryUnit\";\nimport { LoadingMessage } from \"./LoadingMessage\";\nimport { LockIcon } from \"./LockIcon\";\nimport { MobileMenu } from \"./MobileMenu\";\nimport { PasteChartDialog } from \"./PasteChartDialog\";\nimport { Section } from \"./Section\";\nimport { ShortcutsDialog } from \"./ShortcutsDialog\";\nimport Stack from \"./Stack\";\nimport { ToolButton } from \"./ToolButton\";\nimport { Tooltip } from \"./Tooltip\";\nimport { UserList } from \"./UserList\";\n\ninterface LayerUIProps {\n  actionManager: ActionManager;\n  appState: AppState;\n  canvas: HTMLCanvasElement | null;\n  setAppState: React.Component<any, AppState>[\"setState\"];\n  elements: readonly NonDeletedExcalidrawElement[];\n  onCollabButtonClick?: () => void;\n  onLockToggle: () => void;\n  onInsertElements: (elements: readonly NonDeletedExcalidrawElement[]) => void;\n  zenModeEnabled: boolean;\n  toggleZenMode: () => void;\n  langCode: Language[\"code\"];\n  isCollaborating: boolean;\n  onExportToBackend?: (\n    exportedElements: readonly NonDeletedExcalidrawElement[],\n    appState: AppState,\n    canvas: HTMLCanvasElement | null,\n  ) => void;\n  renderCustomFooter?: (isMobile: boolean) => JSX.Element;\n}\n\nconst useOnClickOutside = (\n  ref: RefObject<HTMLElement>,\n  cb: (event: MouseEvent) => void,\n) => {\n  useEffect(() => {\n    const listener = (event: MouseEvent) => {\n      if (!ref.current) {\n        return;\n      }\n\n      if (\n        event.target instanceof Element &&\n        (ref.current.contains(event.target) ||\n          !document.body.contains(event.target))\n      ) {\n        return;\n      }\n\n      cb(event);\n    };\n    document.addEventListener(\"pointerdown\", listener, false);\n\n    return () => {\n      document.removeEventListener(\"pointerdown\", listener);\n    };\n  }, [ref, cb]);\n};\n\nconst LibraryMenuItems = ({\n  library,\n  onRemoveFromLibrary,\n  onAddToLibrary,\n  onInsertShape,\n  pendingElements,\n  setAppState,\n}: {\n  library: LibraryItems;\n  pendingElements: LibraryItem;\n  onRemoveFromLibrary: (index: number) => void;\n  onInsertShape: (elements: LibraryItem) => void;\n  onAddToLibrary: (elements: LibraryItem) => void;\n  setAppState: React.Component<any, AppState>[\"setState\"];\n}) => {\n  const isMobile = useIsMobile();\n  const numCells = library.length + (pendingElements.length > 0 ? 1 : 0);\n  const CELLS_PER_ROW = isMobile ? 4 : 6;\n  const numRows = Math.max(1, Math.ceil(numCells / CELLS_PER_ROW));\n  const rows = [];\n  let addedPendingElements = false;\n\n  rows.push(\n    <div className=\"layer-ui__library-header\">\n      <ToolButton\n        key=\"import\"\n        type=\"button\"\n        title={t(\"buttons.load\")}\n        aria-label={t(\"buttons.load\")}\n        icon={load}\n        onClick={() => {\n          importLibraryFromJSON()\n            .then(() => {\n              // Maybe we should close and open the menu so that the items get updated.\n              // But for now we just close the menu.\n              setAppState({ isLibraryOpen: false });\n            })\n            .catch(muteFSAbortError)\n            .catch((error) => {\n              setAppState({ errorMessage: error.message });\n            });\n        }}\n      />\n      <ToolButton\n        key=\"export\"\n        type=\"button\"\n        title={t(\"buttons.export\")}\n        aria-label={t(\"buttons.export\")}\n        icon={exportFile}\n        onClick={() => {\n          saveLibraryAsJSON()\n            .catch(muteFSAbortError)\n            .catch((error) => {\n              setAppState({ errorMessage: error.message });\n            });\n        }}\n      />\n\n      <a href=\"https://libraries.excalidraw.com\" target=\"_excalidraw_libraries\">\n        {t(\"labels.libraries\")}\n      </a>\n    </div>,\n  );\n\n  for (let row = 0; row < numRows; row++) {\n    const y = CELLS_PER_ROW * row;\n    const children = [];\n    for (let x = 0; x < CELLS_PER_ROW; x++) {\n      const shouldAddPendingElements: boolean =\n        pendingElements.length > 0 &&\n        !addedPendingElements &&\n        y + x >= library.length;\n      addedPendingElements = addedPendingElements || shouldAddPendingElements;\n\n      children.push(\n        <Stack.Col key={x}>\n          <LibraryUnit\n            elements={library[y + x]}\n            pendingElements={\n              shouldAddPendingElements ? pendingElements : undefined\n            }\n            onRemoveFromLibrary={onRemoveFromLibrary.bind(null, y + x)}\n            onClick={\n              shouldAddPendingElements\n                ? onAddToLibrary.bind(null, pendingElements)\n                : onInsertShape.bind(null, library[y + x])\n            }\n          />\n        </Stack.Col>,\n      );\n    }\n    rows.push(\n      <Stack.Row align=\"center\" gap={1} key={row}>\n        {children}\n      </Stack.Row>,\n    );\n  }\n\n  return (\n    <Stack.Col align=\"start\" gap={1} className=\"layer-ui__library-items\">\n      {rows}\n    </Stack.Col>\n  );\n};\n\nconst LibraryMenu = ({\n  onClickOutside,\n  onInsertShape,\n  pendingElements,\n  onAddToLibrary,\n  setAppState,\n}: {\n  pendingElements: LibraryItem;\n  onClickOutside: (event: MouseEvent) => void;\n  onInsertShape: (elements: LibraryItem) => void;\n  onAddToLibrary: () => void;\n  setAppState: React.Component<any, AppState>[\"setState\"];\n}) => {\n  const ref = useRef<HTMLDivElement | null>(null);\n  useOnClickOutside(ref, (event) => {\n    // If click on the library icon, do nothing.\n    if ((event.target as Element).closest(\".ToolIcon_type_button__library\")) {\n      return;\n    }\n    onClickOutside(event);\n  });\n\n  const [libraryItems, setLibraryItems] = useState<LibraryItems>([]);\n\n  const [loadingState, setIsLoading] = useState<\n    \"preloading\" | \"loading\" | \"ready\"\n  >(\"preloading\");\n\n  const loadingTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    Promise.race([\n      new Promise((resolve) => {\n        loadingTimerRef.current = setTimeout(() => {\n          resolve(\"loading\");\n        }, 100);\n      }),\n      Library.loadLibrary().then((items) => {\n        setLibraryItems(items);\n        setIsLoading(\"ready\");\n      }),\n    ]).then((data) => {\n      if (data === \"loading\") {\n        setIsLoading(\"loading\");\n      }\n    });\n    return () => {\n      clearTimeout(loadingTimerRef.current!);\n    };\n  }, []);\n\n  const removeFromLibrary = useCallback(async (indexToRemove) => {\n    const items = await Library.loadLibrary();\n    const nextItems = items.filter((_, index) => index !== indexToRemove);\n    Library.saveLibrary(nextItems);\n    setLibraryItems(nextItems);\n  }, []);\n\n  const addToLibrary = useCallback(\n    async (elements: LibraryItem) => {\n      const items = await Library.loadLibrary();\n      const nextItems = [...items, elements];\n      onAddToLibrary();\n      Library.saveLibrary(nextItems);\n      setLibraryItems(nextItems);\n    },\n    [onAddToLibrary],\n  );\n\n  return loadingState === \"preloading\" ? null : (\n    <Island padding={1} ref={ref} className=\"layer-ui__library\">\n      {loadingState === \"loading\" ? (\n        <div className=\"layer-ui__library-message\">\n          {t(\"labels.libraryLoadingMessage\")}\n        </div>\n      ) : (\n        <LibraryMenuItems\n          library={libraryItems}\n          onRemoveFromLibrary={removeFromLibrary}\n          onAddToLibrary={addToLibrary}\n          onInsertShape={onInsertShape}\n          pendingElements={pendingElements}\n          setAppState={setAppState}\n        />\n      )}\n    </Island>\n  );\n};\n\nconst LayerUI = ({\n  actionManager,\n  appState,\n  setAppState,\n  canvas,\n  elements,\n  onCollabButtonClick,\n  onLockToggle,\n  onInsertElements,\n  zenModeEnabled,\n  toggleZenMode,\n  isCollaborating,\n  onExportToBackend,\n  renderCustomFooter,\n}: LayerUIProps) => {\n  const isMobile = useIsMobile();\n\n  const renderEncryptedIcon = () => (\n    <a\n      className={clsx(\"encrypted-icon tooltip zen-mode-visibility\", {\n        \"zen-mode-visibility--hidden\": zenModeEnabled,\n      })}\n      href=\"https://blog.excalidraw.com/end-to-end-encryption/\"\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n    >\n      <Tooltip label={t(\"encrypted.tooltip\")} position=\"above\" long={true}>\n        {shield}\n      </Tooltip>\n    </a>\n  );\n\n  const renderExportDialog = () => {\n    const createExporter = (type: ExportType): ExportCB => async (\n      exportedElements,\n      scale,\n    ) => {\n      if (canvas) {\n        await exportCanvas(type, exportedElements, appState, canvas, {\n          exportBackground: appState.exportBackground,\n          name: appState.name,\n          viewBackgroundColor: appState.viewBackgroundColor,\n          scale,\n          shouldAddWatermark: appState.shouldAddWatermark,\n        })\n          .catch(muteFSAbortError)\n          .catch((error) => {\n            console.error(error);\n            setAppState({ errorMessage: error.message });\n          });\n      }\n    };\n\n    return (\n      <ExportDialog\n        elements={elements}\n        appState={appState}\n        actionManager={actionManager}\n        onExportToPng={createExporter(\"png\")}\n        onExportToSvg={createExporter(\"svg\")}\n        onExportToClipboard={createExporter(\"clipboard\")}\n        onExportToBackend={\n          onExportToBackend\n            ? (elements) => {\n                onExportToBackend &&\n                  onExportToBackend(elements, appState, canvas);\n              }\n            : undefined\n        }\n      />\n    );\n  };\n\n  const renderCanvasActions = () => (\n    <Section\n      heading=\"canvasActions\"\n      className={clsx(\"zen-mode-transition\", {\n        \"transition-left\": zenModeEnabled,\n      })}\n    >\n      {/* the zIndex ensures this menu has higher stacking order,\n         see https://github.com/excalidraw/excalidraw/pull/1445 */}\n      <Island padding={2} style={{ zIndex: 1 }}>\n        <Stack.Col gap={4}>\n          <Stack.Row gap={1} justifyContent=\"space-between\">\n            {actionManager.renderAction(\"loadScene\")}\n            {actionManager.renderAction(\"saveScene\")}\n            {actionManager.renderAction(\"saveAsScene\")}\n            {renderExportDialog()}\n            {actionManager.renderAction(\"clearCanvas\")}\n            {onCollabButtonClick && (\n              <CollabButton\n                isCollaborating={isCollaborating}\n                collaboratorCount={appState.collaborators.size}\n                onClick={onCollabButtonClick}\n              />\n            )}\n          </Stack.Row>\n          <BackgroundPickerAndDarkModeToggle\n            actionManager={actionManager}\n            appState={appState}\n            setAppState={setAppState}\n          />\n        </Stack.Col>\n      </Island>\n    </Section>\n  );\n\n  const renderSelectedShapeActions = () => (\n    <Section\n      heading=\"selectedShapeActions\"\n      className={clsx(\"zen-mode-transition\", {\n        \"transition-left\": zenModeEnabled,\n      })}\n    >\n      <Island className={CLASSES.SHAPE_ACTIONS_MENU} padding={2}>\n        <SelectedShapeActions\n          appState={appState}\n          elements={elements}\n          renderAction={actionManager.renderAction}\n          elementType={appState.elementType}\n        />\n      </Island>\n    </Section>\n  );\n\n  const closeLibrary = useCallback(\n    (event) => {\n      setAppState({ isLibraryOpen: false });\n    },\n    [setAppState],\n  );\n\n  const deselectItems = useCallback(() => {\n    setAppState({\n      selectedElementIds: {},\n      selectedGroupIds: {},\n    });\n  }, [setAppState]);\n\n  const libraryMenu = appState.isLibraryOpen ? (\n    <LibraryMenu\n      pendingElements={getSelectedElements(elements, appState)}\n      onClickOutside={closeLibrary}\n      onInsertShape={onInsertElements}\n      onAddToLibrary={deselectItems}\n      setAppState={setAppState}\n    />\n  ) : null;\n\n  const renderFixedSideContainer = () => {\n    const shouldRenderSelectedShapeActions = showSelectedShapeActions(\n      appState,\n      elements,\n    );\n\n    return (\n      <FixedSideContainer side=\"top\">\n        <div className=\"App-menu App-menu_top\">\n          <Stack.Col\n            gap={4}\n            className={clsx({ \"disable-pointerEvents\": zenModeEnabled })}\n          >\n            {renderCanvasActions()}\n            {shouldRenderSelectedShapeActions && renderSelectedShapeActions()}\n          </Stack.Col>\n          <Section heading=\"shapes\">\n            {(heading) => (\n              <Stack.Col gap={4} align=\"start\">\n                <Stack.Row gap={1}>\n                  <Island\n                    padding={1}\n                    className={clsx({ \"zen-mode\": zenModeEnabled })}\n                  >\n                    <HintViewer appState={appState} elements={elements} />\n                    {heading}\n                    <Stack.Row gap={1}>\n                      <ShapesSwitcher\n                        elementType={appState.elementType}\n                        setAppState={setAppState}\n                        isLibraryOpen={appState.isLibraryOpen}\n                      />\n                    </Stack.Row>\n                  </Island>\n                  <LockIcon\n                    zenModeEnabled={zenModeEnabled}\n                    checked={appState.elementLocked}\n                    onChange={onLockToggle}\n                    title={t(\"toolBar.lock\")}\n                  />\n                </Stack.Row>\n                {libraryMenu}\n              </Stack.Col>\n            )}\n          </Section>\n          <UserList\n            className={clsx(\"zen-mode-transition\", {\n              \"transition-right\": zenModeEnabled,\n            })}\n          >\n            {Array.from(appState.collaborators)\n              // Collaborator is either not initialized or is actually the current user.\n              .filter(([_, client]) => Object.keys(client).length !== 0)\n              .map(([clientId, client]) => (\n                <Tooltip\n                  label={client.username || \"Unknown user\"}\n                  key={clientId}\n                >\n                  {actionManager.renderAction(\"goToCollaborator\", clientId)}\n                </Tooltip>\n              ))}\n          </UserList>\n        </div>\n      </FixedSideContainer>\n    );\n  };\n\n  const renderBottomAppMenu = () => {\n    return (\n      <div\n        className={clsx(\"App-menu App-menu_bottom zen-mode-transition\", {\n          \"App-menu_bottom--transition-left\": zenModeEnabled,\n        })}\n      >\n        <Stack.Col gap={2}>\n          <Section heading=\"canvasActions\">\n            <Island padding={1}>\n              <ZoomActions\n                renderAction={actionManager.renderAction}\n                zoom={appState.zoom}\n              />\n            </Island>\n            {renderEncryptedIcon()}\n          </Section>\n        </Stack.Col>\n      </div>\n    );\n  };\n\n  const renderFooter = () => (\n    <footer role=\"contentinfo\" className=\"layer-ui__wrapper__footer\">\n      <div\n        className={clsx(\"zen-mode-transition\", {\n          \"transition-right disable-pointerEvents\": zenModeEnabled,\n        })}\n      >\n        {renderCustomFooter?.(false)}\n        {actionManager.renderAction(\"toggleShortcuts\")}\n      </div>\n      <button\n        className={clsx(\"disable-zen-mode\", {\n          \"disable-zen-mode--visible\": zenModeEnabled,\n        })}\n        onClick={toggleZenMode}\n      >\n        {t(\"buttons.exitZenMode\")}\n      </button>\n      {appState.scrolledOutside && (\n        <button\n          className=\"scroll-back-to-content\"\n          onClick={() => {\n            setAppState({\n              ...calculateScrollCenter(elements, appState, canvas),\n            });\n          }}\n        >\n          {t(\"buttons.scrollBackToContent\")}\n        </button>\n      )}\n    </footer>\n  );\n\n  const dialogs = (\n    <>\n      {appState.isLoading && <LoadingMessage />}\n      {appState.errorMessage && (\n        <ErrorDialog\n          message={appState.errorMessage}\n          onClose={() => setAppState({ errorMessage: null })}\n        />\n      )}\n      {appState.showShortcutsDialog && (\n        <ShortcutsDialog\n          onClose={() => setAppState({ showShortcutsDialog: false })}\n        />\n      )}\n      {appState.pasteDialog.shown && (\n        <PasteChartDialog\n          setAppState={setAppState}\n          appState={appState}\n          onInsertChart={onInsertElements}\n          onClose={() =>\n            setAppState({\n              pasteDialog: { shown: false, data: null },\n            })\n          }\n        />\n      )}\n    </>\n  );\n\n  return isMobile ? (\n    <>\n      {dialogs}\n      <MobileMenu\n        appState={appState}\n        elements={elements}\n        actionManager={actionManager}\n        libraryMenu={libraryMenu}\n        exportButton={renderExportDialog()}\n        setAppState={setAppState}\n        onCollabButtonClick={onCollabButtonClick}\n        onLockToggle={onLockToggle}\n        canvas={canvas}\n        isCollaborating={isCollaborating}\n        renderCustomFooter={renderCustomFooter}\n      />\n    </>\n  ) : (\n    <div className=\"layer-ui__wrapper\">\n      {dialogs}\n      {renderFixedSideContainer()}\n      {renderBottomAppMenu()}\n      {\n        <aside\n          className={clsx(\n            \"layer-ui__wrapper__github-corner zen-mode-transition\",\n            {\n              \"transition-right\": zenModeEnabled,\n            },\n          )}\n        >\n          <GitHubCorner appearance={appState.appearance} />\n        </aside>\n      }\n      {renderFooter()}\n    </div>\n  );\n};\n\nconst areEqual = (prev: LayerUIProps, next: LayerUIProps) => {\n  const getNecessaryObj = (appState: AppState): Partial<AppState> => {\n    const {\n      suggestedBindings,\n      startBoundElement: boundElement,\n      ...ret\n    } = appState;\n    return ret;\n  };\n  const prevAppState = getNecessaryObj(prev.appState);\n  const nextAppState = getNecessaryObj(next.appState);\n\n  const keys = Object.keys(prevAppState) as (keyof Partial<AppState>)[];\n  return (\n    prev.langCode === next.langCode &&\n    prev.elements === next.elements &&\n    keys.every((key) => prevAppState[key] === nextAppState[key])\n  );\n};\n\nexport default React.memo(LayerUI, areEqual);\n"]},"metadata":{},"sourceType":"module"}